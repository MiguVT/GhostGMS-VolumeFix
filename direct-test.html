<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct GMS Control Panel Test</title>
    <style>
        /* Basic styling to simulate Tailwind */
        body {
            background-color: #111827;
            color: white;
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1f2937;
            border-radius: 8px;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 16px;
        }
        
        button {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        button:hover {
            background-color: #1d4ed8;
        }
        
        .hidden {
            display: none !important;
        }
        
        .flex {
            display: flex !important;
        }
        
        .modal {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.75);
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        
        .modal-content {
            background-color: #1f2937;
            padding: 16px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
        }
        
        textarea {
            width: 100%;
            background-color: #374151;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px;
            min-height: 200px;
            margin-bottom: 16px;
        }
        
        .log-container {
            background-color: #111827;
            border-radius: 4px;
            padding: 8px;
            margin-top: 16px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .log-entry {
            margin-bottom: 4px;
        }
        
        .log-entry.error {
            color: #ef4444;
        }
        
        .log-entry.success {
            color: #10b981;
        }
        
        .button-green {
            background-color: #10b981;
        }
        
        .button-green:hover {
            background-color: #059669;
        }
        
        .button-red {
            background-color: #ef4444;
        }
        
        .button-red:hover {
            background-color: #dc2626;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>GMS Control Panel Direct Test</h1>
        <p>This page tests the GMS Control Panel functions directly without requiring a server.</p>
        
        <div>
            <button id="editButton" class="button-green">Edit GMS Services</button>
            <button id="testModal" class="button-green">Test Edit Modal</button>
            <button id="testSave" class="button-green">Test Save Function</button>
            <button id="testClear">Clear Console</button>
        </div>
        
        <div class="log-container" id="consoleOutput">
            <div class="log-entry">Ready to test...</div>
        </div>
        
        <!-- Hidden elements needed by the code -->
        <div style="display:none">
            <span id="moduleVer"></span>
            <span id="serviceStatus"></span>
            <span id="servicePID"></span>
            <img id="imgGhost">
            <input type="checkbox" id="killLogdSwitch">
            <input type="checkbox" id="miscOptSwitch">
            <button id="editGamelistButton">Edit</button>
            <button id="saveLogsButton">Save</button>
            <button id="applyButton">Apply</button>
            <button id="disableAnythingButton">Reset</button>
            <button id="clearOutputButton">Clear</button>
            <div id="outputConsole"></div>
        </div>
    </div>
    
    <!-- Modal for edit GMS Services -->
    <div id="gmslistModal" class="modal hidden">
        <div class="modal-content">
            <h2>Edit GMS Services</h2>
            <p>GMS services listed here will be toggled on/off when using the Optimize GMS Services switch</p>
            <textarea id="gmslistInput" rows="10"></textarea>
            <div class="button-container">
                <button id="cancelEditButton">Cancel</button>
                <button id="saveEditButton">Save</button>
            </div>
        </div>
    </div>
    
    <script>
        // Mock the functions used in the main script
        let a = 0;
        
        // Mock console output function
        function logOutput(message, isError = false) {
            console.log(`${isError ? "[ERROR]" : "[INFO]"} ${message}`);
            
            const consoleOutput = document.getElementById("consoleOutput");
            const entry = document.createElement("div");
            entry.className = isError ? "log-entry error" : "log-entry success";
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleOutput.appendChild(entry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        // Mock toast function
        function l(message) {
            console.log("Toast:", message);
            
            const toast = document.createElement("div");
            toast.style.position = "fixed";
            toast.style.bottom = "20px";
            toast.style.left = "50%";
            toast.style.transform = "translateX(-50%)";
            toast.style.backgroundColor = "rgba(0, 0, 0, 0.8)";
            toast.style.color = "white";
            toast.style.padding = "10px 20px";
            toast.style.borderRadius = "4px";
            toast.style.zIndex = "9999";
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 3000);
        }
        
        // Mock the command execution function
        function c(cmd) {
            return new Promise((resolve) => {
                logOutput(`Simulating command: ${cmd}`);
                
                if (cmd.includes("get_gmslist") || cmd.includes("get_gamelist")) {
                    setTimeout(() => {
                        resolve({
                            errno: 0,
                            stdout: "com.google.android.gms\ncom.google.android.gms.ads.identifier.service.AdvertisingIdService\ncom.google.android.gms.nearby.mediums.nearfieldcommunication.NfcAdvertisingService",
                            stderr: ""
                        });
                    }, 500);
                } else if (cmd.includes("save_gmslist") || cmd.includes("save_gamelist")) {
                    setTimeout(() => {
                        resolve({
                            errno: 0,
                            stdout: "Saved successfully",
                            stderr: ""
                        });
                    }, 1000);
                } else {
                    resolve({
                        errno: 0,
                        stdout: "Command executed successfully",
                        stderr: ""
                    });
                }
            });
        }
        
        // Implementation of the modal open function
        async function openGmsListEditor() {
            logOutput("Opening GMS Services editor...");
            
            try {
                const modal = document.getElementById("gmslistModal");
                const textarea = document.getElementById("gmslistInput");
                
                if (!modal) {
                    logOutput("Error: GMS Services modal element not found (ID: gmslistModal)", true);
                    return;
                }
                
                if (!textarea) {
                    logOutput("Error: GMS Services textarea element not found (ID: gmslistInput)", true);
                    return;
                }
                
                // Call get_gmslist with error handling
                try {
                    const {errno, stdout, stderr} = await c("ghost-utils get_gmslist");
                    
                    if (errno === 0) {
                        // Success - update the textarea and show the modal
                        const formattedContent = stdout.trim().replace(/\|/g, "\n");
                        textarea.value = formattedContent;
                        
                        // Show the modal
                        modal.classList.remove("hidden");
                        
                        logOutput("GMS Services list loaded successfully");
                    } else {
                        // Command error
                        logOutput(`Error loading GMS Services list: ${stderr || "Unknown error"}`, true);
                    }
                } catch (err) {
                    // Exception during command execution
                    logOutput(`Exception loading GMS Services list: ${err.message}`, true);
                }
            } catch (err) {
                // General exception
                logOutput(`Unexpected error opening edit window: ${err.message}`, true);
            }
        }
        
        // Implementation of the save function
        async function saveGmsList() {
            try {
                const textarea = document.getElementById("gmslistInput");
                const modal = document.getElementById("gmslistModal");
                
                if (!textarea) {
                    logOutput("Error: GMS Services textarea element not found when saving", true);
                    return;
                }
                
                // Get text and format it
                const gmsListContent = textarea.value.trim().replace(/\n+/g,"|");
                logOutput("Saving GMS Services list...");
                
                try {
                    // Call the script to save
                    const {errno, stdout, stderr} = await c(`ghost-utils save_gmslist "${gmsListContent}"`);
                    
                    if (errno === 0) {
                        // Success
                        logOutput("GMS Services list saved successfully");
                        l("GMS Services list saved successfully.");
                        
                        // Hide the modal if it exists
                        if (modal) {
                            modal.classList.add("hidden");
                        }
                    } else {
                        // Command error
                        logOutput(`Error saving GMS Services list: ${stderr || "Unknown error"}`, true);
                    }
                } catch (err) {
                    // Exception during command execution
                    logOutput(`Exception saving GMS Services list: ${err.message}`, true);
                }
            } catch (err) {
                // General exception
                logOutput(`Unexpected error saving GMS list: ${err.message}`, true);
            }
        }
        
        // Clear output function
        function clearOutput() {
            const consoleOutput = document.getElementById("consoleOutput");
            consoleOutput.innerHTML = '<div class="log-entry">Console cleared.</div>';
        }
        
        // Initialize UI on document load
        document.addEventListener("DOMContentLoaded", function() {
            // Set up event listeners for edit button on main UI
            document.getElementById("editButton").addEventListener("click", function() {
                openGmsListEditor();
            });
            
            // Test modal button
            document.getElementById("testModal").addEventListener("click", function() {
                openGmsListEditor();
            });
            
            // Test save button
            document.getElementById("testSave").addEventListener("click", function() {
                saveGmsList();
            });
            
            // Test clear button
            document.getElementById("testClear").addEventListener("click", function() {
                clearOutput();
            });
            
            // Cancel button in modal
            document.getElementById("cancelEditButton").addEventListener("click", function() {
                const modal = document.getElementById("gmslistModal");
                if (modal) {
                    modal.classList.add("hidden");
                }
            });
            
            // Save button in modal
            document.getElementById("saveEditButton").addEventListener("click", function() {
                saveGmsList();
            });
            
            document.getElementById("applyButton").addEventListener("click", function() {
                logOutput("Applying settings...");
                setTimeout(() => {
                    logOutput("Settings applied successfully");
                    l("Settings applied successfully");
                }, 800);
            });
            
            logOutput("Test page initialized and ready!");
        });
    </script>
</body>
</html> 